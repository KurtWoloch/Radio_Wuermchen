# ðŸ“» Radio WÃ¼rmchen: Agent-Driven Internet Radio Station

This repository contains the full architecture for a personalized, autonomous radio station where OpenClaw Agents (the DJ Brain) curate the playlist, generate witty announcements using TTS, and manage the stream continuity.

## 1. Current Architecture (Python Streamer)

The original Liquidsoap dependency was replaced with a robust, two-process Python/FFmpeg pipe chain managed by a long-running Python script.

| Layer | Component | Role |
| :--- | :--- | :--- |
| **Intelligence** | OpenClaw Cron Agent (DJ Brain) | **Autonomous DJ:** Responds to JSON requests, selects the next song, generates announcement scripts, and calls the `tts` tool to create audio files. |
| **Automation** | `radio_streamer.py` | **Stream Coordinator:** Runs in a continuous loop, manages the file-based communication protocol (`dj_request.json`/`dj_response.json`), concatenates announcement MP3s with music segments, and streams the result. |
| **Streaming** | FFmpeg (Internal Call) | Encodes the segment (`announcement + song`) and pushes it directly to the Icecast source mount. |
| **Distribution** | Icecast Server | Broadcasts the stream to clients via the `/stream` mountpoint. |

## 2. Agent Communication Workflow (The DJ Brain)

The `radio_streamer.py` script coordinates the playback loop with the OpenClaw Cron Agent. This ensures low latency and offloads all creative work and tool execution (TTS) to the AI.

1. **Request:** `radio_streamer.py` writes `radio-wuermchen/dj_request.json` (modes: `select_track`, `suggest_options`, `generate_announcement`).
2. **Execution:** The Cron Agent (running every 5s) detects the file and executes the LLM logic based on the `mode`.
3. **Response:** The Cron Agent writes the result (e.g., suggested track, announcement MP3 path) to `radio-wuermchen/dj_response.json`.
4. **Action:** `radio_streamer.py` reads the response, executes the FFmpeg segment stream, and starts the loop over.
5. **Fallback:** If an LLM-suggested track is not found in the local library (`music.playlist`), the track is added to `wishlist.txt`, and the agent is asked to select from a list of 5 available, random songs.

## 3. Getting Started

### Prerequisites

*   Python 3.11+ (installed at `C:\Program Files\Python311\`)
*   FFmpeg (installed at `C:\msys64\mingw64\bin\ffmpeg.exe`)
*   Icecast Server (installed at `C:\Program Files\Icecast\`)
*   OpenClaw Gateway running with the configured cron job for the DJ Brain.

### Running the Stream (Requires Manual Icecast Start)

1. **Start Icecast:** Manually launch the Icecast server (e.g., run `icecast.bat` in its installation directory) in a separate terminal.
2. **Start Streamer:** Run the batch file to start the streaming logic:
    ```bash
    radio-wuermchen\run_dj_streamer.bat
    ```
3. **Listen:** The stream should be available at `http://localhost:8000/stream`.

## 4. Current Status and Known Bugs

The system is fully functional for multiple segments but is currently unstable due to system environment interactions.

*   **Status:** Stream works, but process crashes after one or two songs due to instability between the Python process and the externally run Icecast server.
*   **Next Focus:** Stabilizing the continuous loop and ensuring the FFmpeg connection is resilient across segment transitions.
*   **Troubleshooting Tool:** Check `radio-wuermchen/dj_log.jsonl` for a detailed, human-readable log of all agent requests and streaming events.

---
_Document generated by Sidestepper ðŸ¦€ (OpenClaw Assistant)_